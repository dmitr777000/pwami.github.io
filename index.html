<!DOCTYPE html>
<html lang="en">
<head>
     <link rel="manifest" href="./pwami/manifest.json" />
    <meta charset="UTF-8">
   <!--  <script  defer></script><!--  -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Page title</title>
</head>
<body>
     <img src="icon192.">.</img>
    <div style="text-align:right"> <button onclick="location.reload()" style="" >заново</button>
    </div>
    <h1 >датаa </h1>
    <button style="width:100%" id="zarg" >зарегить</button>
    <div id="tablel"></div>
    <button id="da" style="display:none" >вторай</button>
    <p></p>
    </body>
    </html>
    <!-- <script src="db.js"> -->
        <script>
            
const h1 =document.querySelector("h1");
const options = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
const today = new Date();
const rut = today.toLocaleDateString('ru-RU', options);
const tabl2  =document.getElementById("tablel");
const button =document.getElementById('zarg')
const button2=document.getElementById("da");
const table  =document.querySelector("p")
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/pwami/sw.js')  // Путь к файлу SW
      .then(registration => {
        console.log('Service Worker зарегистрирован успешно:', registration.scope);
      })
      .catch(error => {
       h1.innerHTML=JSON.stringify(error, null, 2); 
     table.innerHTML=error;
      });
  });
}
Notification.requestPermission().then(function(permission) {
  if (permission === 'granted') {
    new Notification('Заголовок', { body: 'Текст уведомления' });
  }
});
            
      navigator.serviceWorker.addEventListener('message', event => 
          {
              const p = document.createElement('p');
    p.textContent = "ошшибк" +event.data;
    document.body.appendChild(p)
          });
    // Можно показать уведомление или кнопку обновления     
            h1.textContent = rut;

 const request = indexedDB.open('MyDatabse', 1);

request.onerror = event => alert("feil data bank")
         
request.onupgradeneeded = event => 
        {
const db = event.target.result; 
db.createObjectStore('dat', { autoIncrement: true });
  alert("создана новая база");
          }
            
request.onsuccess = event => 
         {
         const db = event.target.result; 
 const transaction = db.transaction('dat', 'readwrite');
const store = transaction.objectStore('dat');

const getAllRequest = store.getAll();  
getAllRequest.onerror = () => alert(`ошибка чтения`);
               
getAllRequest.onsuccess = () =>
               {
      const allRecords = getAllRequest.result ;
table.style.background = "PaleGreen";
let list = '<ul>';
for (let i = 0; i < allRecords.length; i++) {
            const vvalue =allRecords[i] ;
            list += `<li><strong>${vvalue}</strong></li>`;
                        }
        list += '</ul>';
        table.innerHTML = list+"конец";
                }
          }
          
button.addEventListener('click',()=> 
     {
         table.remove();
       h1.textContent =`вы уверены?`;
              tabl2.style.height = "200px";
              tabl2.style.background = "maroon";
            tabl2.style.marginBottom = "40px";
 button.remove();
button2.textContent =`дааа!, ,${rut}`;
button2.style.display ="";
        }
                        );
            
            
button2.addEventListener('click',()=>     
    {
tabl2.style.height = "";
button2.remove();
h1.textContent=" ошибка аааа";

const request = indexedDB.open('MyDatabse', 1);
request.onsuccess = event => 
         {
         const db = event.target.result; 
  const transaction = db.transaction('dat', 'readwrite');
  const store = transaction.objectStore('dat');
  store.add(rut);
  const getAllRequest = store.getAll();
                  
  
  getAllRequest.onsuccess = () =>
       {
      const allRecords = getAllRequest.result;
h1.textContent =`УсПех !!`;
tabl2.style.background = "PaleGreen";
let list = '<ul>';
        for (let i = 0; i < allRecords.length; i++) {
            const vvalue =allRecords[i] ;
            list += `<li><strong>${vvalue}</strong></li>`;
                        }
        list += '</ul>';
        tabl2.innerHTML = list+"конец";
        }
       
        
                }        
    });

        </script>

</body>
</html>
